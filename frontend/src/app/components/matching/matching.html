<div class="matching-container">
  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>æ–°ã—ã„å‡ºä¼šã„ã‚’æ¢ã—ã¦ã„ã¾ã™...</p>
  </div>

  <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ãªã„å ´åˆ -->
  <div *ngIf="!loading && noMoreUsers" class="no-users-container">
    <div class="no-users-card">
      <h2>ğŸ° ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h2>
      <p>ä»Šã¯æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“ã€‚<br>ã¾ãŸå¾Œã§ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
      <button class="btn btn-primary" (click)="reloadMatches()">
        ãƒªãƒ­ãƒ¼ãƒ‰
      </button>
      <a routerLink="/dashboard" class="btn btn-secondary">
        ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
      </a>
    </div>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚¨ãƒªã‚¢ -->
  <div *ngIf="!loading && !noMoreUsers" class="matching-area">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="matching-header">
      <h1>ğŸ† æ–°ã—ã„å‡ºä¼šã„</h1>
      <p>ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ãƒ‘ãƒã‚¹ãƒ­ä»²é–“ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</p>
    </div>

    <!-- ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ -->
    <div class="card-stack" #cardStack>
      <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
      <div 
        *ngIf="getCurrentUser()" 
        class="user-card main-card"
        (touchstart)="onTouchStart($event)"
        (touchmove)="onTouchMove($event)"
        (touchend)="onTouchEnd($event)"
        (mousedown)="onMouseDown($event)"
        (mousemove)="onMouseMove($event)"
        (mouseup)="onMouseUp($event)"
      >
        <div class="card-content">
          <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ -->
          <div class="profile-image">
            <img 
              [src]="getCurrentUser()?.profileImage || '/assets/images/default-avatar.png'" 
              [alt]="getCurrentUser()?.name + 'ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ'"
              onerror="this.src='/assets/images/default-avatar.png'"
            >
          </div>

          <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
          <div class="user-info">
            <div class="user-basic">
              <h2>{{ getCurrentUser()?.name }}</h2>
              <span class="age">{{ getAge(getCurrentUser()!) }}æ­³</span>
            </div>
            
            <div class="user-location">
              <span class="location-icon">ğŸ“</span>
              {{ getCurrentUser()?.prefecture }} {{ getCurrentUser()?.city }}
            </div>

            <div class="user-bio" *ngIf="getCurrentUser()?.bio">
              <p>{{ getCurrentUser()?.bio }}</p>
            </div>

            <!-- ãƒ‘ãƒã‚¹ãƒ­æƒ…å ± -->
            <div class="pachinko-info">
              <div class="info-section" *ngIf="getCurrentUser()?.favoriteSlots?.length">
                <h4>ğŸ° å¥½ããªæ©Ÿç¨®</h4>
                <div class="slot-tags">
                  <span 
                    *ngFor="let slot of getCurrentUser()?.favoriteSlots?.slice(0, 3)" 
                    class="slot-tag"
                  >
                    {{ slot }}
                  </span>
                  <span 
                    *ngIf="(getCurrentUser()?.favoriteSlots?.length || 0) > 3"
                    class="slot-tag more"
                  >
                    +{{ (getCurrentUser()?.favoriteSlots?.length || 0) - 3 }}
                  </span>
                </div>
              </div>

              <div class="play-style" *ngIf="getCurrentUser()?.budget || getCurrentUser()?.frequency">
                <div class="style-item" *ngIf="getCurrentUser()?.budget">
                  <span class="label">ğŸ’° äºˆç®—:</span>
                  <span class="value">{{ getCurrentUser()?.budget }}</span>
                </div>
                <div class="style-item" *ngIf="getCurrentUser()?.frequency">
                  <span class="label">ğŸ“… é »åº¦:</span>
                  <span class="value">{{ getCurrentUser()?.frequency }}</span>
                </div>
              </div>

              <div class="time-slots" *ngIf="getCurrentUser()?.timeSlots?.length">
                <h4>â° éŠæŠ€æ™‚é–“</h4>
                <div class="time-tags">
                  <span 
                    *ngFor="let timeSlot of getCurrentUser()?.timeSlots" 
                    class="time-tag"
                  >
                    {{ timeSlot }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ’ãƒ³ãƒˆ -->
        <div class="swipe-hint like-overlay">
          <span>ğŸ’– LIKE</span>
        </div>
        <div class="swipe-hint pass-overlay">
          <span>âŒ PASS</span>
        </div>
      </div>

      <!-- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚«ãƒ¼ãƒ‰ -->
      <div *ngIf="getNextUser()" class="user-card background-card">
        <div class="card-content">
          <div class="profile-image">
            <img 
              [src]="getNextUser()?.profileImage || '/assets/images/default-avatar.png'" 
              [alt]="getNextUser()?.name + 'ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ'"
              onerror="this.src='/assets/images/default-avatar.png'"
            >
          </div>
          <div class="user-info">
            <div class="user-basic">
              <h2>{{ getNextUser()?.name }}</h2>
              <span class="age">{{ getAge(getNextUser()!) }}æ­³</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="action-buttons">
      <button 
        class="action-btn pass-btn" 
        (click)="onPass()"
        [disabled]="!getCurrentUser()"
      >
        <span class="btn-icon">âŒ</span>
        <span class="btn-text">Pass</span>
      </button>
      
      <button 
        class="action-btn like-btn" 
        (click)="onLike()"
        [disabled]="!getCurrentUser()"
      >
        <span class="btn-icon">ğŸ’–</span>
        <span class="btn-text">Like</span>
      </button>
    </div>

    <!-- ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¬ã‚¤ãƒ‰ -->
    <div class="swipe-guide">
      <p>â† å·¦ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã§Pass ãƒ» å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã§Like â†’</p>
    </div>
  </div>

  <!-- ãƒãƒƒãƒé€šçŸ¥ -->
  <div *ngIf="showMatchNotification" class="match-notification-overlay">
    <div class="match-notification">
      <div class="match-animation">
        <div class="fireworks"></div>
        <h2>ğŸ‰ ãƒãƒƒãƒæˆç«‹ï¼</h2>
        <p>{{ matchedUser?.name }}ã•ã‚“ã¨ãƒãƒƒãƒã—ã¾ã—ãŸï¼</p>
        
        <div class="match-users">
          <div class="match-user">
            <img 
              [src]="matchedUser?.profileImage || '/assets/images/default-avatar.png'" 
              [alt]="matchedUser?.name"
              onerror="this.src='/assets/images/default-avatar.png'"
            >
            <p>{{ matchedUser?.name }}</p>
          </div>
        </div>
        
        <div class="match-actions">
          <button class="btn btn-primary" routerLink="/messages">
            ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹
          </button>
          <button class="btn btn-secondary" (click)="closeMatchNotification()">
            ç¶šã‘ã‚‹
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
